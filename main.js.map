{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/visualiser.js","webpack:///./src/components/radio.js","webpack:///./src/index.js"],"names":["enumerable","get","getter","value","key","bind","module","Object","prototype","hasOwnProperty","call","object","property","Visualiser","audio","canvas","icon","this","context","getContext","audioContext","window","AudioContext","webkitAudioContext","analyser","createAnalyser","createMediaElementSource","connect","destination","dataArray","Uint8Array","frequencyBinCount","width","innerWidth","height","innerHeight","centerX","centerY","setIcon","initCanvas","cancelAnimationFrame","requestID","initArray","readyState","getByteFrequencyData","i","rads","Math","PI","barHeight","x","cos","y","sin","xEnd","yEnd","drawBar","requestAnimationFrame","animate","x1","y1","x2","y2","frequency","strokeStyle","lineWidth","beginPath","moveTo","lineTo","stroke","state","className","Radio","playing","visualiser","document","getElementById","button","addEventListener","play","pause","stop","renderStats","response","a","listenerCount","icestats","source","listeners","constructor","reduce","total","innerHTML","init","statsLoop","networkPromise","fetch","mode","then","blob","json","timeOutPromise","Promise","resolve","setTimeout","all"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export default class Visualiser {\n  /**\n   * Create a new Visualiser.\n   *\n   * @param audio\n   * @param canvas\n   */\n  constructor(audio, canvas, icon) {\n    this.audio = audio;\n    this.canvas = canvas;\n    this.icon = icon;\n\n    this.context = this.canvas.getContext('2d');\n  }\n\n  /**\n   * Initialise audio analyser array.\n   */\n  initArray() {\n    const audioContext = new (window.AudioContext || window.webkitAudioContext)();\n    this.analyser = audioContext.createAnalyser();\n\n    const source = audioContext.createMediaElementSource(this.audio);\n    source.connect(this.analyser);\n\n    this.analyser.connect(audioContext.destination);\n    this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n  }\n\n  /**\n   * Set the canvas to the window width and get the center point.\n   */\n  initCanvas() {\n    this.canvas.width = window.innerWidth;\n    this.canvas.height = window.innerHeight;\n\n    this.centerX = this.canvas.width / 2;\n    this.centerY = this.canvas.height / 2;\n  }\n\n  /**\n   * Stop visualisation animations.\n   */\n  stop() {\n    this.setIcon('paused');\n    this.initCanvas();\n    window.cancelAnimationFrame(this.requestID);\n  }\n\n  /**\n   * Animate.\n   */\n  animate() {\n    if (!this.dataArray) {\n      this.initArray();\n    }\n\n    if (this.audio && this.audio.readyState < 3) {\n      this.setIcon('loading');\n    } else {\n      this.setIcon('playing');\n    }\n\n    this.initCanvas();\n\n    this.analyser.getByteFrequencyData(this.dataArray);\n\n    const bars = 200;\n    const barWidth = 2;\n    const radius = 100;\n\n    for (let i = 0; i < bars; i += 1) {\n      const rads = Math.PI * 2 / bars;\n      const barHeight = this.dataArray[i] * 0.7;\n      const x = this.centerX + Math.cos(rads * i) * (radius);\n      const y = this.centerY + Math.sin(rads * i) * (radius);\n      const xEnd = this.centerX + Math.cos(rads * i) * (radius + barHeight);\n      const yEnd = this.centerY + Math.sin(rads * i) * (radius + barHeight);\n      this.drawBar(x, y, xEnd, yEnd, barWidth, this.dataArray[i]);\n    }\n\n    this.requestID = window.requestAnimationFrame(this.animate.bind(this));\n  }\n\n  /**\n   * Draw a single bar.\n   */\n  drawBar(x1, y1, x2, y2, width, frequency) {\n    const lineColor = `rgb(255, 255, 255)`;\n    this.context.strokeStyle = lineColor;\n    this.context.lineWidth = width;\n    this.context.beginPath();\n    this.context.moveTo(x1, y1);\n    this.context.lineTo(x2, y2);\n    this.context.stroke();\n  }\n\n  /**\n   * Update the icon state.\n   *\n   * @param state\n   */\n  setIcon(state) {\n    let icon;\n\n    if (state === 'paused') {\n      icon = 'fa-play';\n    } else if (state === 'playing') {\n      icon = 'fa-pause';\n    } else if (state === 'loading') {\n      icon = 'fa-spinner fa-pulse';\n    }\n\n    this.icon.className = `fas ${icon} fa-2x`;\n  }\n}\n","import Visualiser from './visualiser';\n\nexport default class Radio {\n  /**\n   * Create a new Radio.\n   *\n   * @param audio\n   * @param canvas\n   */\n  constructor(audio, canvas) {\n    this.audio = audio;\n    this.canvas = canvas;\n    this.playing = false;\n\n    this.visualiser = new Visualiser(this.audio, this.canvas, document.getElementById('icon'));\n  }\n\n  /**\n   * Initalise the visualiser.\n   *\n   * @param button\n   */\n  init(button) {\n    button.addEventListener('click', () => {\n      if (this.playing === false) {\n        this.play();\n      } else {\n        this.pause();\n      }\n    });\n  }\n\n  /**\n   * Play the stream\n   */\n  play() {\n    this.playing = true;\n    this.audio.play();\n    this.visualiser.animate();\n  }\n\n  /**\n   * Pause the stream.\n   */\n  pause() {\n    this.playing = false;\n    this.audio.pause();\n    this.visualiser.stop();\n  }\n}\n","import Radio from './components/radio';\n\n// Initialize radio\ndocument.addEventListener('DOMContentLoaded', () => {\n  const radio = new Radio(\n    document.getElementById('audio'),\n    document.getElementById('renderer'),\n  );\n\n  radio.init(document.getElementById('button'));\n});\n\n// Checks if var is object\nfunction isObject(a) {\n  return !!a && a.constructor === Object;\n}\n\n// renders the listener stats\nfunction renderStats(response) {\n  let listenerCount = 0;\n  // only one stream, continue as normal\n  if (typeof response.icestats.source.listeners !== 'undefined') {\n    listenerCount = response.icestats.source.listeners;\n  }\n\n  // more than one stream has been listed\n  if (\n    typeof response.icestats.source[0] !== 'undefined' && isObject(response.icestats.source[0])\n  ) {\n    // loop through the streams add up all the listeners\n    listenerCount = response.icestats.source.reduce((total, source) => total + source.listeners, 0);\n  }\n\n  // Update the listener count\n  document.getElementById('listeners').innerHTML = listenerCount;\n}\n\n\n// polls server for stats\nfunction statsLoop() {\n  // Promise resolves when 200 happens\n  const networkPromise = fetch('https://radio.fam.wtf/status-json.xsl', {\n    mode: 'no-cors',\n  })\n    .then(blob => blob.json())\n    .then(response => renderStats(response));\n\n  // Promise resolves after 10 seconds\n  const timeOutPromise = new Promise((resolve) => {\n    setTimeout(resolve, 10000);\n  });\n\n  // Once all promises have resolved\n  Promise.all([networkPromise, timeOutPromise]).then(() => {\n    // Repeat\n    statsLoop();\n  });\n}\n\n// Start polling\nstatsLoop();\n"],"sourceRoot":""}